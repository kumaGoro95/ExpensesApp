<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<th:block th:insert="fragments/header :: header"></th:block>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	th:href="@{/webjars/materializecss/1.0.0/css/materialize.min.css}">
<script type="text/javascript"
	th:src="@{/webjars/materializecss/1.0.0/js/materialize.min.js/}"></script>
<script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}"></script>
<link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<title>title</title>
</head>
<body>
	<div class="list">
		<h1>投稿</h1>
		<span th:inline="text"> ユーザー:[[${post.username}]] -
			内容:[[${post.postBody}]] - 登録日時:[[${post.createdAt}]] -
			更新日時:[[${post.updatedAt}]] </span> 
			 <span th:if="${user.username == post.username}">
                <a
			th:href="@{/editPost/__${post.postId}__}">編集</a> <a
			th:href="@{/deletePost/__${post.postId}__}">削除</a>
            </span>
			
		<h1>コメント</h1>
		<div th:each="comment : ${comments}" th:inline="text">
			ユーザー:[[${comment.username}]] - 内容:[[${comment.commentBody}]] -
			登録日時:[[${comment.createdAt}]] - 更新日時:[[${comment.updatedAt}]] 
			<span th:if="${user.username == comment.username}">
			<a
				th:href="@{/editComment/__${comment.commentId}__}">編集</a> <a
				th:href="@{/deleteComment/__${comment.commentId}__}">削除</a>
				</span>
		</div>
		<section class="post" data-postid="${post.postId}">
		<div class="btn-good"><i class="fa-heart fa-lg px-16
        <th:if(isGood($_SESSION['user_id'],$dbPostData['id'])){ //いいね押したらハートが塗りつぶされる
                echo ' active fas';
            }else{ //いいねを取り消したらハートのスタイルが取り消される
                echo ' far';
            }; ?>"></i><span><?php echo $dbPostGoodNum; ?></span>
		</section>
		
		
		 <a
			th:href="@{/likesList/__${post.postId}__}"><p
				th:text="${theNumberOfLikes}"></p></a>
	</div>
	<div class="comment">
		<h3>コメント入力</h3>
		<form th:action="@{/postComment}" th:object="${comment}" method="post"
			novalidate>
			<input type="hidden" name="username" th:value="${user.username}" />
			<input type="hidden" name="postId" th:value="${post.postId}" />
			<div class="form-group">
				<label for="note">本文</label>
				<textarea rows="5" cols="40" th:errorclass="is-invalid"
					th:field="*{commentBody}"></textarea>
				<div class="invalid-feedback" th:errors="*{commentBody}"></div>
			</div>

			<div class="form-check"></div>
			<button class="btn">登録</button>
		</form>
	</div>
	</div>
	<script>
	$(function(){
	    var $good = $('.btn-good'), //いいねボタンセレクタ
	                goodPostId; //投稿ID
	    $good.on('click',function(e){
	        e.stopPropagation();
	        var $this = $(this);
	        //カスタム属性（postid）に格納された投稿ID取得
	        goodPostId = $this.parents('.post').data('postid'); 
	        $.ajax({
	            type: 'POST',
	            url: , `/like/${postid}` //post送信を受けとるphpファイル
	            data: { postId: goodPostId} //{キー:投稿ID}
	        }).done(function(data){
	            console.log('Ajax Success');

	            // いいねの総数を表示
	            $this.children('span').html(data);
	            // いいね取り消しのスタイル
	            $this.children('i').toggleClass('far'); //空洞ハート
	            // いいね押した時のスタイル
	            $this.children('i').toggleClass('fas'); //塗りつぶしハート
	            $this.children('i').toggleClass('active');
	            $this.toggleClass('active');
	        }).fail(function(msg) {
	            console.log('Ajax Error');
	        });
	    });
	});
	
	</script>
</body>
</html>